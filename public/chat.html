<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>#REDChat ‚Äì Chat</title>
<style>
* { box-sizing:border-box; margin:0; padding:0; }
body { font-family: system-ui, -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu; background:#f5f5f5; height:100vh; display:flex; flex-direction:column; }
header { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 16px; background:#fff; border-bottom:1px solid #e0e0e0; position:sticky; top:0; z-index:10; }
header button { background:none; border:none; font-size:20px; cursor:pointer; }
header .room-name { font-weight:600; font-size:16px; cursor:pointer; }
header .user-id { font-size:12px; color:#666; }
.chat { flex:1; padding:16px; overflow-y:auto; display:flex; flex-direction:column; gap:8px; }
.bubble { max-width:75%; padding:10px 14px; border-radius:16px; font-size:14px; line-height:1.4; word-wrap:break-word; position:relative; }
.me { align-self:flex-end; background:#e53935; color:#fff; border-bottom-right-radius:4px; }
.other { align-self:flex-start; background:#e0e0e0; color:#000; border-bottom-left-radius:4px; }
.timestamp { font-size:10px; color:#666; position:absolute; bottom:-14px; right:10px; }
.read-status { font-size:10px; color:#fff; position:absolute; bottom:-14px; left:10px; }
.input-area { display:flex; gap:8px; padding:10px; background:#fff; border-top:1px solid #e0e0e0; }
.input-area input { flex:1; padding:12px; border-radius:20px; border:1px solid #ddd; outline:none; font-size:14px; }
.input-area button { background:#e53935; color:#fff; border:none; border-radius:50%; width:44px; height:44px; font-size:16px; cursor:pointer; }
.emoji-picker { display:flex; flex-wrap:wrap; gap:6px; padding:6px; background:#fff; border-top:1px solid #ddd; }
.emoji-picker span { font-size:20px; cursor:pointer; }
.profile-modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); display:none; justify-content:center; align-items:center; z-index:20; }
.profile-content { background:#fff; border-radius:12px; padding:20px; width:300px; text-align:center; }
.profile-content img { width:80px; height:80px; border-radius:50%; margin-bottom:10px; cursor:pointer; }
.profile-content input { width:80%; padding:6px; margin:5px 0; border-radius:6px; border:1px solid #ccc; }
.profile-content button { margin-top:10px; padding:8px 16px; border:none; border-radius:8px; background:#e53935; color:#fff; cursor:pointer; }
</style>
</head>
<body>

<header>
  <button onclick="goBack()">‚Üê</button>
  <div class="room-name" id="roomName">Chat</div>
  <div class="user-id" id="userId"></div>
</header>

<div class="chat" id="chatBox"></div>

<div class="input-area">
  <input id="messageInput" type="text" placeholder="Type a message" />
  <button onclick="sendMessage()">‚û§</button>
</div>

<div class="emoji-picker" id="emojiPicker">
  <span>üòä</span><span>üòÇ</span><span>üëç</span><span>‚ù§Ô∏è</span><span>üéâ</span><span>üòé</span><span>üôå</span>
</div>

<div class="profile-modal" id="profileModal">
  <div class="profile-content">
    <img id="profileAvatar" src="https://via.placeholder.com/80" alt="Avatar" onclick="changeAvatar()">
    <input type="text" id="profileNameInput" placeholder="Display Name">
    <p id="profileEmail">email@example.com</p>
    <button onclick="saveProfile()">Save</button>
    <button onclick="logout()">Logout</button>
    <button onclick="closeProfile()">Close</button>
  </div>
</div>

<script>
// Current user mock
const currentEmail = localStorage.getItem('userEmail') || 'john.doe@example.com';
const currentUser = emailToUser(currentEmail);
document.getElementById("userId").innerText = currentUser.username;

// Helper
function emailToUser(email){
  const [name] = email.split('@');
  const displayName = name.split('.').map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(' ');
  return {name: displayName, username:'@'+name, email};
}

// Rooms mock
const params = new URLSearchParams(window.location.search);
const roomId = params.get("room") || 'self';
let roomUser;
const rooms = {
  self: emailToUser(currentEmail),
  user_1: emailToUser('red.biz@example.com'),
  user_2: emailToUser('bapak.qu@example.com'),
  user_3: emailToUser('cikal.user@example.com')
};
roomUser = rooms[roomId] || {name:'Unknown', username:'@unknown', email:'unknown@example.com'};
document.getElementById('roomName').innerText = roomId==='self'?roomUser.name:roomUser.name+' '+roomUser.username;
document.getElementById('profileEmail').innerText = roomUser.email;
document.getElementById('profileNameInput').value = roomUser.name;

// Mock messages
const chatBox = document.getElementById('chatBox');
let mockMessages = {
  self:[{from:'me',text:'Catatan pribadi üòä',time:'09:00',read:true}],
  user_1:[{from:'other',text:'Halo üëã',time:'10:00'},{from:'me',text:'Hai üëç',time:'10:02',read:true}],
  user_2:[{from:'other',text:'Telepon tak terjawab üòÖ',time:'11:00'},{from:'me',text:'Siap',time:'11:05',read:false}],
  user_3:[{from:'other',text:'Foto üì∏',time:'12:00'},{from:'me',text:'Terima kasih ‚ù§Ô∏è',time:'12:05',read:false}]
};

function renderMessages(){
  chatBox.innerHTML='';
  const messages = mockMessages[roomId] || [];
  messages.forEach(m=>{
    const bubble = document.createElement('div');
    bubble.className='bubble '+m.from;
    bubble.innerText=m.text;
    const ts = document.createElement('div');
    ts.className='timestamp';
    ts.innerText = m.time;
    bubble.appendChild(ts);
    if(m.from==='me'){
      const readDiv = document.createElement('div');
      readDiv.className='read-status';
      readDiv.innerText = m.read?'‚úÖ':'';
      bubble.appendChild(readDiv);
    }
    chatBox.appendChild(bubble);
  });
  chatBox.scrollTop = chatBox.scrollHeight;
}

renderMessages();

// Send message
const input = document.getElementById('messageInput');
function sendMessage(){
  const text = input.value.trim();
  if(!text) return;
  const bubble = document.createElement('div');
  bubble.className='bubble me';
  bubble.innerText = text;

  const ts = document.createElement('div');
  const time = new Date();
  const hh = String(time.getHours()).padStart(2,'0');
  const mm = String(time.getMinutes()).padStart(2,'0');
  ts.className='timestamp';
  ts.innerText = `${hh}:${mm}`;
  bubble.appendChild(ts);

  const readDiv = document.createElement('div');
  readDiv.className='read-status';
  readDiv.innerText='‚úÖ';
  bubble.appendChild(readDiv);

  chatBox.appendChild(bubble);
  input.value='';
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Enter key
input.addEventListener('keypress', e=>{ if(e.key==='Enter') sendMessage(); });

// Emoji picker
document.querySelectorAll('#emojiPicker span').forEach(e=>{
  e.addEventListener('click', ()=>{ input.value += e.innerText; input.focus(); });
});

// Back
function goBack(){ window.location.href='room.html'; }

// Profile modal
const profileModal = document.getElementById('profileModal');
function openProfile(){ profileModal.style.display='flex'; }
function closeProfile(){ profileModal.style.display='none'; }
document.getElementById('roomName').addEventListener('click', openProfile);

// Profile edit
function saveProfile(){
  const newName = document.getElementById('profileNameInput').value.trim();
  if(newName) roomUser.name = newName;
  document.getElementById('roomName').innerText = roomId==='self'?roomUser.name:roomUser.name+' '+roomUser.username;
  closeProfile();
}
function changeAvatar(){ alert('Avatar change dialog (mock)'); }

// Logout
function logout(){ localStorage.removeItem('userEmail'); window.location.href='login.html'; }

// Auto-scroll on resize
window.addEventListener('resize', ()=>{ chatBox.scrollTop = chatBox.scrollHeight; });
</script>
</body>
</html>
