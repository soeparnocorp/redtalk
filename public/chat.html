<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>REDTalk – Chat</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu;
  background:#f5f5f5;
  height:100vh;
  display:flex;
  flex-direction:column;
}
/* HEADER */
header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:12px 16px;
  background:#fff;
  border-bottom:1px solid #e0e0e0;
  position:sticky;
  top:0;
  z-index:10;
}
header .room-name { font-weight:600; font-size:16px; }
header button { background:none; border:none; font-size:20px; cursor:pointer; }
/* CHAT AREA */
.chat {
  flex:1;
  padding:16px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.bubble { max-width:75%; padding:10px 14px; border-radius:16px; font-size:14px; line-height:1.4; word-wrap:break-word; }
.me { align-self:flex-end; background:#e53935; color:#fff; border-bottom-right-radius:4px; }
.other { align-self:flex-start; background:#e0e0e0; color:#000; border-bottom-left-radius:4px; }
/* INPUT AREA */
.input-area { display:flex; gap:8px; padding:10px; background:#fff; border-top:1px solid #e0e0e0; }
.input-area input { flex:1; padding:12px; border-radius:20px; border:1px solid #ddd; outline:none; font-size:14px; }
.input-area button { background:#e53935; color:#fff; border:none; border-radius:50%; width:44px; height:44px; font-size:16px; cursor:pointer; }
</style>
</head>
<body>

<header>
  <button onclick="goBack()">←</button>
  <div class="room-name" id="roomName">Chat</div>
  <div class="user-id" id="userId"></div>
</header>

<div class="chat" id="chatBox">
  <!-- messages akan inject JS -->
</div>

<div class="input-area">
  <input id="messageInput" type="text" placeholder="Type a message" />
  <button onclick="sendMessage()">➤</button>
</div>

<script>
  const userEmail = localStorage.getItem('userEmail') || 'guest@redchat.dev';
  document.getElementById('userId').innerText = userEmail;

  // Ambil room dari query string
  const params = new URLSearchParams(window.location.search);
  const room = params.get("room") || "Chat";
  const roomNameEl = document.getElementById("roomName");

  // Jika self chat, tampilkan email
  roomNameEl.innerText = room==='self'?userEmail:room;

  const chatBox = document.getElementById('chatBox');

  // Mock messages per room
  const mockMessages = {
    self: [
      {from:'me', text:'Catatan pertama di Kamarku'},
      {from:'me', text:'Jangan lupa meeting jam 3!'}
    ],
    user_1: [
      {from:'other', text:'Halo, RED di sini'},
      {from:'me', text:'Hai, saya ingin info terbaru'}
    ],
    user_2: [
      {from:'other', text:'Telepon tak terjawab'},
      {from:'me', text:'Siap, saya follow up'}
    ],
    user_3: [
      {from:'other', text:'Foto dikirim'},
      {from:'me', text:'Terima kasih'}
    ]
  };

  function renderMessages() {
    chatBox.innerHTML='';
    const messages = mockMessages[room] || [];
    messages.forEach(m=>{
      const bubble = document.createElement('div');
      bubble.className = 'bubble '+m.from;
      bubble.innerText = m.text;
      chatBox.appendChild(bubble);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  renderMessages();

  // Send message
  const input = document.getElementById('messageInput');
  function sendMessage() {
    const text = input.value.trim();
    if(!text) return;
    const bubble = document.createElement('div');
    bubble.className='bubble me';
    bubble.innerText=text;
    chatBox.appendChild(bubble);
    input.value='';
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  // Enter key send
  input.addEventListener('keypress', e=>{
    if(e.key==='Enter') sendMessage();
  });

  function goBack() {
    window.location.href='room.html';
  }

  // Auto-scroll resize mobile keyboard (simple)
  window.addEventListener('resize', ()=>{
    chatBox.scrollTop = chatBox.scrollHeight;
  });
</script>

</body>
</html>
